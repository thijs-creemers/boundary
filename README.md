# Boundary Framework

A module-centric Clojure framework implementing the Functional Core / Imperative Shell architectural paradigm.

## Quick Start

**→ [Documentation](https://github.com/thijs-creemers/boundary-docs) ←** - Complete documentation (separate repository)

**→ [Developer Guide (AGENTS.md)](./AGENTS.md) ←** - Comprehensive reference for development, architecture, and advanced topics

The **[Documentation](https://github.com/thijs-creemers/boundary-docs)** provides architecture guides, tutorials, how-to guides, API references, and ADRs. The **Developer Guide** offers a quick reference for AI agents and developers with commands, patterns, and troubleshooting.

### Minimal Setup

```zsh
# Prerequisites: JDK and Clojure CLI
brew install openjdk clojure/tools/clojure  # macOS

# Clone and verify
git clone <repo-url> boundary
cd boundary
clojure -M:test                           # Run tests (auto-loads required drivers)
clojure -M:repl-clj                       # Start REPL
clojure -X:mcp # runs clojure-mcp server as configured in ~/.clojure/deps.edn

opencode setup, Auto starts mcp but startup fails when the repl is not running.
``` json
{"mcp":
    "clojure-mcp": {
      "type": "local",
      "command": [
        "clojure",
        "-X:mcp"
      ]
    }
}
```

## Architecture

Boundary implements a **clean architecture** pattern with proper separation of concerns. Each domain module (`user`, `billing`, `workflow`) follows a layered structure:

### Core Principles
- **Domain Layer**: Pure business entities and validation rules (Malli schemas)
- **Ports Layer**: Repository interfaces and contracts
- **Application Layer**: Database-agnostic business services using dependency injection
- **Infrastructure Layer**: Database adapters, external APIs, and I/O implementations
- **Multi-Interface Support**: Consistent behavior across REST, CLI, and Web
- **RFC 7807 Error Handling**: Standardized HTTP error responses with proper context separation

### User Module Example
```
src/boundary/user/
├── schema.clj              # Domain entities (Malli schemas)
├── ports.clj               # Repository interfaces
├── shell/
│   └── service.clj         # Database-agnostic business services
└── infrastructure/
    └── database.clj        # Database-specific implementations
```

**Key Benefits:**
- Business logic completely separated from infrastructure
- Easy to test with mocked dependencies
- Database-agnostic services that work with any storage implementation
- Clear dependency flow: Infrastructure → Ports ← Services

See [Documentation](https://github.com/thijs-creemers/boundary-docs) for detailed technical specifications.

## Validation DevEx (quick links)

- Guide: [boundary-docs validation guide](https://github.com/thijs-creemers/boundary-docs/tree/main/content/reference/validation-guide.adoc)
- Coverage reports: test/reports/coverage/user.{edn,txt}
- Snapshot tests:
  ```zsh
  UPDATE_SNAPSHOTS=true clojure -M:test:db/h2 --focus boundary.user.core.user-validation-snapshot-test
  clojure -M:test:db/h2 --focus boundary.user.core.user-validation-snapshot-test
  ```
- GraphViz export:
  ```clojure
  (require '[boundary.shared.tools.validation.repl :as v])
  (spit "build/validation-user.dot" (v/rules->dot {:modules #{:user}}))
  ```

## Screenshots

- Validation rules (GraphViz)

  ![Validation Rules Graph](docs/diagrams/validation-user.png)

  Generate locally:
  ```zsh
  # Generate DOT from REPL helpers
  clojure -M:repl-clj <<'EOF'
  (require '[boundary.shared.tools.validation.repl :as v])
  (spit "build/validation-user.dot" (v/rules->dot {:modules #{:user}}))
  (System/exit 0)
  EOF

  # Render PNG (requires graphviz `dot`)
  dot -Tpng build/validation-user.dot -o docs/diagrams/validation-user.png
  ```

- Coverage summary (text artifact)

  See: `test/reports/coverage/user.txt` (generated by behavior specs)

## CI snippets

### GitHub Actions

```yaml
name: validation
on:
  push:
    branches: [ main ]
  pull_request:
  workflow_dispatch:
    inputs:
      updateSnapshots:
        description: "Update snapshots"
        type: boolean
        default: false
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: '21'
      - name: Cache Maven
        uses: actions/cache@v4
        with:
          path: ~/.m2/repository
          key: ${{ runner.os }}-m2-${{ hashFiles('**/deps.edn') }}
      - name: Run tests (with optional snapshot update)
        env:
          UPDATE_SNAPSHOTS: ${{ inputs.updateSnapshots && 'true' || '' }}
        run: |
          clojure -M:test:db/h2
      - name: Upload coverage artifacts
        uses: actions/upload-artifact@v4
        with:
          name: coverage-user
          path: |
            test/reports/coverage/user.edn
            test/reports/coverage/user.txt
      - name: Upload validation graph (if present)
        if: ${{ hashFiles('docs/diagrams/validation-user.png') != '' }}
        uses: actions/upload-artifact@v4
        with:
          name: validation-graph
          path: docs/diagrams/validation-user.png
```

### GitLab CI

```yaml
stages: [test]
validation:
  image: clojure:temurin-21-tools-deps
  variables:
    UPDATE_SNAPSHOTS: "${UPDATE_SNAPSHOTS}"
  script:
    - clojure -M:test:db/h2
  artifacts:
    when: always
    paths:
      - test/reports/coverage/user.edn
      - test/reports/coverage/user.txt
      - docs/diagrams/validation-user.png
```

## Documentation

**Main Documentation**: [boundary-docs repository](https://github.com/thijs-creemers/boundary-docs)

The documentation has been moved to a separate repository for better organization and independent evolution. Visit the link above for:

- **Architecture** - Architecture patterns and design principles
- **Guides** - Tutorials and how-to guides including Quickstart
- **Reference** - Commands, configuration, error codes, and scaffolder
- **API Examples** - Complete API implementation examples
- **ADRs** - Architecture Decision Records

### Developer Resources
- **[AGENTS.md](./AGENTS.md)** - Comprehensive developer and agent guide
- **[BUILD.md](./BUILD.md)** - Build and deployment instructions
- **[CONTRIBUTING.md](./CONTRIBUTING.md)** - Contribution guidelines
- **[PROJECT_STATUS.adoc](./PROJECT_STATUS.adoc)** - Current project status

### Key Documentation (External)
- **[Architecture Documentation](https://github.com/thijs-creemers/boundary-docs/tree/main/content/architecture)** - System architecture and design
- **[Observability Integration](https://github.com/thijs-creemers/boundary-docs/tree/main/content/guides/integrate-observability.adoc)** - Logging, metrics, and error reporting
- **[Roadmap](https://github.com/thijs-creemers/boundary-docs/tree/main/content/roadmap.adoc)** - Project roadmap and future plans
