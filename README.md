# Boundary Framework

A module-centric Clojure framework implementing the Functional Core / Imperative Shell architectural paradigm.

## Quick Start

**→ [User Guide](docs/user-guide/index.adoc) ←** - Get started with tutorials and practical how-to guides

**→ [Developer Guide (warp.md)](./warp.md) ←** - Comprehensive reference for development, architecture, and advanced topics

The **User Guide** provides persona-based learning paths, quickstart tutorials, and step-by-step how-to guides for common tasks. The **Developer Guide** offers in-depth architectural documentation and complete development reference.

### Minimal Setup

```zsh
# Prerequisites: JDK and Clojure CLI
brew install openjdk clojure/tools/clojure  # macOS

# Clone and verify
git clone <repo-url> boundary
cd boundary
clojure -M:test                           # Run tests (auto-loads required drivers)
clojure -M:repl-clj                       # Start REPL
clojure -X:mcp # runs clojure-mcp server as configured in ~/.clojure/deps.edn

opencode setup, Auto starts mcp but startup fails when the repl is not running.
``` json
{"mcp":
    "clojure-mcp": {
      "type": "local",
      "command": [
        "clojure",
        "-X:mcp"
      ]
    }
}
```

## Architecture

Boundary implements a **clean architecture** pattern with proper separation of concerns. Each domain module (`user`, `billing`, `workflow`) follows a layered structure:

### Core Principles
- **Domain Layer**: Pure business entities and validation rules (Malli schemas)
- **Ports Layer**: Repository interfaces and contracts
- **Application Layer**: Database-agnostic business services using dependency injection
- **Infrastructure Layer**: Database adapters, external APIs, and I/O implementations
- **Multi-Interface Support**: Consistent behavior across REST, CLI, and Web

### User Module Example
```
src/boundary/user/
├── schema.clj              # Domain entities (Malli schemas)
├── ports.clj               # Repository interfaces
├── shell/
│   └── service.clj         # Database-agnostic business services
└── infrastructure/
    └── database.clj        # Database-specific implementations
```

**Key Benefits:**
- Business logic completely separated from infrastructure
- Easy to test with mocked dependencies
- Database-agnostic services that work with any storage implementation
- Clear dependency flow: Infrastructure → Ports ← Services

See [Architecture Documentation](docs/architecture/) for detailed technical specifications.

## Validation DevEx (quick links)

- Guide: docs/validation-guide.adoc (REPL helpers, snapshots, behavior DSL, coverage)
- Coverage reports: test/reports/coverage/user.{edn,txt}
- Snapshot tests:
  ```zsh
  UPDATE_SNAPSHOTS=true clojure -M:test:db/h2 --focus boundary.user.core.user-validation-snapshot-test
  clojure -M:test:db/h2 --focus boundary.user.core.user-validation-snapshot-test
  ```
- GraphViz export:
  ```clojure
  (require '[boundary.shared.tools.validation.repl :as v])
  (spit "build/validation-user.dot" (v/rules->dot {:modules #{:user}}))
  ```

## Screenshots

- Validation rules (GraphViz)

  ![Validation Rules Graph](docs/diagrams/validation-user.png)

  Generate locally:
  ```zsh
  # Generate DOT from REPL helpers
  clojure -M:repl-clj <<'EOF'
  (require '[boundary.shared.tools.validation.repl :as v])
  (spit "build/validation-user.dot" (v/rules->dot {:modules #{:user}}))
  (System/exit 0)
  EOF

  # Render PNG (requires graphviz `dot`)
  dot -Tpng build/validation-user.dot -o docs/diagrams/validation-user.png
  ```

- Coverage summary (text artifact)

  See: `test/reports/coverage/user.txt` (generated by behavior specs)

## CI snippets

### GitHub Actions

```yaml
name: validation
on:
  push:
    branches: [ main ]
  pull_request:
  workflow_dispatch:
    inputs:
      updateSnapshots:
        description: "Update snapshots"
        type: boolean
        default: false
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: '21'
      - name: Cache Maven
        uses: actions/cache@v4
        with:
          path: ~/.m2/repository
          key: ${{ runner.os }}-m2-${{ hashFiles('**/deps.edn') }}
      - name: Run tests (with optional snapshot update)
        env:
          UPDATE_SNAPSHOTS: ${{ inputs.updateSnapshots && 'true' || '' }}
        run: |
          clojure -M:test:db/h2
      - name: Upload coverage artifacts
        uses: actions/upload-artifact@v4
        with:
          name: coverage-user
          path: |
            test/reports/coverage/user.edn
            test/reports/coverage/user.txt
      - name: Upload validation graph (if present)
        if: ${{ hashFiles('docs/diagrams/validation-user.png') != '' }}
        uses: actions/upload-artifact@v4
        with:
          name: validation-graph
          path: docs/diagrams/validation-user.png
```

### GitLab CI

```yaml
stages: [test]
validation:
  image: clojure:temurin-21-tools-deps
  variables:
    UPDATE_SNAPSHOTS: "${UPDATE_SNAPSHOTS}"
  script:
    - clojure -M:test:db/h2
  artifacts:
    when: always
    paths:
      - test/reports/coverage/user.edn
      - test/reports/coverage/user.txt
      - docs/diagrams/validation-user.png
```

## Documentation

### Development
- **[Developer Guide (warp.md)](./warp.md)** - Complete development reference
- **[PRD Summary](docs/PRD-IMPROVEMENT-SUMMARY.adoc)** - Project requirements and improvements
- **[Full PRD](docs/boundary.prd.adoc)** - Comprehensive product requirements

### Architecture
- **[Architecture Overview](docs/architecture/overview.adoc)** - High-level architectural decisions
- **[Component Architecture](docs/architecture/components.adoc)** - Detailed component interactions
- **[Data Flow](docs/architecture/data-flow.adoc)** - Request processing patterns
- **[Ports and Adapters](docs/architecture/ports-and-adapters.adoc)** - Hexagonal architecture guide
- **[User Module Architecture](docs/user-module-architecture.md)** - Clean architecture implementation example

### Infrastructure & Migration
- **[Migration Guide](docs/migration-guide.md)** - Step-by-step migration to new infrastructure
- **[Infrastructure Examples](examples/user_infrastructure_example.clj)** - Working code examples
- **[Refactoring Summary](INFRASTRUCTURE-REFACTOR-SUMMARY.md)** - Complete overview of changes
- **[Dynamic Driver Loading](docs/DYNAMIC_DRIVER_LOADING.md)** - Automatic JDBC driver loading system
- **[Observability Integration](docs/OBSERVABILITY_INTEGRATION.md)** - Complete guide for logging, metrics, and error reporting

### Build Documentation

```bash
# Build individual documents
asciidoctor -D build/docs docs/architecture/components.adoc
asciidoctor -D build/docs docs/architecture/data-flow.adoc

# Build all architecture docs
``` bash
```
cd docs/architecture && for doc in *.adoc; do asciidoctor -D ../../build/docs "$doc"; done
cd -
```
```
```
