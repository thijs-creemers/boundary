= Configure Database Connections

[[overview]]
== Overview

Boundary supports multiple databases through dynamic driver loading. The framework automatically loads the appropriate JDBC driver based on your configuration, making it easy to switch between SQLite, PostgreSQL, MySQL, and H2.

[[default-sqlite]]
== Default: SQLite

=== Out-of-the-Box Configuration

By default, Boundary uses **SQLite** for development:

* **File-based** database (`dev-database.db` in project root)
* **Zero configuration** required
* **No external services** needed
* **Perfect for local development**

=== SQLite Configuration

The default configuration in `{config-dir}/conf/dev/config.edn`:

[source,clojure]
----
:active
{:boundary/sqlite
 {:db "dev-database.db"
  :pool {:minimum-idle 1
         :maximum-pool-size 3
         :connection-timeout-ms 10000}}}
----

=== When to Use SQLite

✅ **Good for:**

* Local development
* Rapid prototyping
* Single-user scenarios
* Testing and demos

❌ **Not ideal for:**

* Production deployments
* Multi-user applications
* High-concurrency scenarios
* Distributed systems

[[switching-to-postgresql]]
== Switching to PostgreSQL

=== Step 1: Start PostgreSQL

Start a PostgreSQL instance (using Docker):

[source,{shell}]
----
# Start PostgreSQL container
docker run --name boundary-postgres \
  -e POSTGRES_USER=boundary_dev \
  -e POSTGRES_PASSWORD=dev_password \
  -e POSTGRES_DB=boundary_dev \
  -p 5432:5432 \
  -d postgres:16-alpine
----

=== Step 2: Set Environment Variables

Create a `.env` file or export variables:

[source,{shell}]
----
# Database connection
export POSTGRES_HOST=localhost
export POSTGRES_PORT=5432
export POSTGRES_DB=boundary_dev
export POSTGRES_USER=boundary_dev
export POSTGRES_PASSWORD=dev_password
----

[CAUTION]
====
**Security Warning**

Never commit `.env` files with real credentials to version control. Use `.env.example` as a template and add `.env` to `.gitignore`.
====

=== Step 3: Update Configuration

Edit `{config-dir}/conf/dev/config.edn` to move PostgreSQL from `:inactive` to `:active`:

[source,clojure]
----
:active
{;; Move PostgreSQL configuration here
 :boundary/postgresql
 {:host          #env "POSTGRES_HOST"
  :port          #env "POSTGRES_PORT"
  :dbname        #env "POSTGRES_DB"
  :user          #env "POSTGRES_USER"
  :password      #env "POSTGRES_PASSWORD"
  :auto-commit   true
  :pool          {:minimum-idle 5
                  :maximum-pool-size 15
                  :connection-timeout-ms 30000}}

 ;; Remove or move SQLite to :inactive
 ;; :boundary/sqlite {...}
}
----

=== Step 4: Restart Your System

Restart the REPL for changes to take effect:

[source,clojure]
----
user=> (ig-repl/halt)
:halted
user=> (ig-repl/go)
:initiated
----

Boundary will now use PostgreSQL! ✅

[[other-databases]]
== Other Databases

=== MySQL

==== Start MySQL

[source,{shell}]
----
docker run --name boundary-mysql \
  -e MYSQL_ROOT_PASSWORD=root_password \
  -e MYSQL_DATABASE=boundary_dev \
  -e MYSQL_USER=boundary_dev \
  -e MYSQL_PASSWORD=dev_password \
  -p 3306:3306 \
  -d mysql:8
----

==== Environment Variables

[source,{shell}]
----
export MYSQL_HOST=localhost
export MYSQL_PORT=3306
export MYSQL_DB=boundary_dev
export MYSQL_USER=boundary_dev
export MYSQL_PASSWORD=dev_password
----

==== Configuration

Add to `:active` section:

[source,clojure]
----
:boundary/mysql
{:host     #env "MYSQL_HOST"
 :port     #env "MYSQL_PORT"
 :dbname   #env "MYSQL_DB"
 :user     #env "MYSQL_USER"
 :password #env "MYSQL_PASSWORD"
 :pool     {:minimum-idle 5
            :maximum-pool-size 15
            :connection-timeout-ms 30000}}
----

[[h2-testing]]
=== H2 (In-Memory Testing)

H2 is used automatically for tests via the `:db/h2` alias:

[source,{shell}]
----
clojure -M:test:db/h2
----

==== For Development

To use H2 in development:

[source,clojure]
----
:boundary/h2
{:memory true  ; In-memory database
 :pool   {:minimum-idle 1
          :maximum-pool-size 10}}
----

[TIP]
====
**H2 is perfect for:**

* Fast test execution
* Temporary development
* CI/CD pipelines

Data is lost when the JVM stops.
====

[[connection-pooling]]
== Connection Pooling

Boundary uses **HikariCP** for connection pooling.

=== Pool Configuration

[source,clojure]
----
:pool {:minimum-idle 5              ; Min connections kept alive
       :maximum-pool-size 15        ; Max connections in pool
       :connection-timeout-ms 30000 ; Wait time before timeout
       :idle-timeout-ms 600000      ; Close idle connections after
       :max-lifetime-ms 1800000}    ; Max connection lifetime
----

=== Tuning for Production

**Development** (low concurrency):
[source,clojure]
----
:pool {:minimum-idle 2
       :maximum-pool-size 5}
----

**Production** (high concurrency):
[source,clojure]
----
:pool {:minimum-idle 10
       :maximum-pool-size 50}
----

[[troubleshooting]]
== Troubleshooting

=== Connection Refused

**Symptom:**
----
Connection refused: localhost:5432
----

**Solution:**

1. Verify database is running: `docker ps`
2. Check port is correct: `5432` for PostgreSQL, `3306` for MySQL
3. Verify environment variables are set: `echo $POSTGRES_HOST`

=== Authentication Failed

**Symptom:**
----
Password authentication failed for user "boundary_dev"
----

**Solution:**

1. Verify credentials match: `echo $POSTGRES_PASSWORD`
2. Check user exists in database
3. Restart REPL to reload environment variables

=== SQLite File Permissions

**Symptom:**
----
SQLiteException: unable to open database file
----

**Solution:**

[source,{shell}]
----
# Check file permissions
ls -la dev-database.db

# Fix if needed
chmod 644 dev-database.db
----

=== Driver Not Found

**Symptom:**
----
No suitable driver found for jdbc:postgresql://...
----

**Solution:**

Ensure you're using the correct alias:

[source,{shell}]
----
# Development - includes all drivers
clojure -M:dev:repl-clj

# Tests - includes all drivers
clojure -M:test:db/h2
----

[[learn-more]]
== Learn More

* {xref-config}[Configuration Reference] - Complete configuration guide
* {xref-troubleshooting}[Troubleshooting] - Database connection issues
* link:../../docs/multi-db-usage.adoc[Multi-Database Usage Guide^] - Advanced scenarios
* link:../../docs/dynamic-driver-loading.adoc[Dynamic Driver Loading^] - How drivers work
