= Validation Patterns and Message Style Guide
include::partial$attributes.adoc[]
:revdate: 2025-11-03

== Overview

This document provides patterns, conventions, and guidelines for implementing validation throughout the Boundary framework. It covers validation architecture, message styling, testing approaches, and common patterns.

== Message Style Guide

=== Core Principles

**Clarity Over Cleverness**

Error messages should be immediately understandable, even to users unfamiliar with the system.

**Actionable Over Descriptive**

Focus on what the user should do, not just what went wrong.

**Consistent Over Creative**

Use established patterns across all modules for predictability.

**Respectful Over Blaming**

Frame errors as system requirements, not user failures.

=== Tone and Voice

==== General Guidelines

**DO:**

- Be direct and concise
- Use active voice
- Focus on the solution
- Provide specific guidance
- Use friendly, professional language

**DON'T:**

- Use passive voice unnecessarily
- Include technical jargon without context
- Blame the user
- Be vague or ambiguous
- Use humor or sarcasm

==== Examples

[cols="1,1"]
|===
|❌ Bad |✅ Good

|"The email field you provided is not valid"
|"Email format is invalid"

|"Your input for the role field was incorrect"
|"Role is not valid"

|"An error occurred while processing your request"
|"Amount must be between 0.01 and 999999.99"

|"You forgot to include the name"
|"Name is required"

|"Oops! Something went wrong with the email"
|"Email already exists"
|===

=== Sentence Structure

==== Required Field Messages

**Pattern:** `[Field Name] is required`

**Examples:**

- "Email is required"
- "Name is required"
- "Tenant ID is required"

**With Context:** `[Field Name] is required [when/for] [context]`

- "Email is required when creating a user"
- "Payment method is required for paid subscriptions"

==== Format Validation Messages

**Pattern:** `[Field Name] has an invalid format` or `[Field Name] format is invalid`

**Detailed Pattern:** `[Field Name] must match the format: [example]`

**Examples:**

- "Email format is invalid"
- "Email must match the format: user@domain.com"
- "UUID must be a valid UUID format"

==== Value Validation Messages

**Pattern:** `[Field Name] has an invalid value` or `[Field Name] is not valid`

**Detailed Pattern:** `[Field Name] must be one of: [list]`

**Examples:**

- "Role is not valid"
- "Role must be one of: admin, user, viewer"
- "Status must be one of: pending, approved, rejected"

==== Range Validation Messages

**Pattern:** `[Field Name] is out of range`

**Detailed Pattern:** `[Field Name] must be between [min] and [max]`

**Examples:**

- "Age is out of range"
- "Age must be between 0 and 120"
- "Amount must be between 0.01 and 999999.99"

==== Length Validation Messages

**Short Pattern:** `[Field Name] is too short`

**Detailed Pattern:** `[Field Name] must be at least [n] characters`

**Long Pattern:** `[Field Name] is too long`

**Detailed Pattern:** `[Field Name] must be at most [n] characters`

**Examples:**

- "Password is too short"
- "Password must be at least 8 characters"
- "Name is too long"
- "Name must be at most 255 characters"

==== Business Rule Messages

**Pattern:** `[Action] [Field Name]` or `[Field Name] [constraint]`

**Examples:**

- "Cannot modify Tenant ID"
- "Email already exists"
- "Status transition not allowed"
- "Billing Address requires Payment Method"

=== Field Name Formatting

==== Capitalization

Use **Title Case** for multi-word field names in messages:

[cols="1,1"]
|===
|Internal Name |Display Name

|`:email`
|"Email"

|`:tenant-id`
|"Tenant ID"

|`:user-agent`
|"User Agent"

|`:created-at`
|"Created At"

|`:billing-address`
|"Billing Address"

|`:payment-method-id`
|"Payment Method ID"
|===

==== Acronyms

Keep common acronyms in all caps:

- "ID" (not "Id")
- "UUID" (not "Uuid")
- "URL" (not "Url")
- "API" (not "Api")

==== Technical vs User-Friendly

For user-facing messages, use friendlier names when appropriate:

[cols="1,1"]
|===
|Technical |User-Friendly

|`:tenant-id`
|"Tenant ID" (API) / "Organization" (UI)

|`:created-at`
|"Created At" (API) / "Date Created" (UI)

|`:auth-token`
|"Auth Token" (API) / "Authentication Token" (UI)
|===

=== Path Display

Format validation paths clearly in error messages:

**Simple Paths:**
[source]
----
Path: email
Path: user.email
----

**Nested Paths:**
[source]
----
Path: user → contact → email
Path: billing → address → postal-code
----

**Array Paths:**
[source]
----
Path: users[0].email
Path: items[2].quantity
----

**Map Paths:**
[source]
----
Path: metadata.tags
Path: config.database.host
----

=== Placeholder Naming

Use consistent placeholder naming in templates:

[cols="1,2"]
|===
|Placeholder |Usage

|`{{field-name}}`
|Human-readable field name

|`{{value}}`
|Actual value (sanitized, truncated if needed)

|`{{expected}}`
|Expected value, format, or pattern

|`{{min}}` / `{{max}}`
|Numeric or length bounds

|`{{allowed}}`
|Comma-separated list of allowed values

|`{{current}}`
|Current state or value in context

|`{{reason}}`
|Explanation for constraint

|`{{dependency}}`
|Name of dependent field

|`{{suggestion}}`
|"Did you mean?" suggestion

|`{{entity}}`
|Entity type (user, invoice, etc.)

|`{{operation}}`
|Operation type (create, update, delete)
|===

=== Value Display

==== String Values

Wrap string values in quotes for clarity:

- ✅ `Role has an invalid value: "moderater"`
- ❌ `Role has an invalid value: moderater`

==== Numeric Values

Display numeric values without quotes:

- ✅ `Age must be between 0 and 120. You provided: 150`
- ❌ `Age must be between "0" and "120". You provided: "150"`

==== Lists

Use comma-separated format with "and" before last item:

- ✅ `Allowed roles: admin, user, and viewer`
- ❌ `Allowed roles: admin user viewer`

==== Truncation

Truncate long values with ellipsis:

- ✅ `Name is too long (300 characters). Maximum: 255 characters`
- ✅ `Value: "This is a very long text that will be trunca..."`

=== Range and Limit Display

==== Inclusive Ranges

Use "between X and Y" for inclusive ranges:

- `Age must be between 0 and 120` (0 ≤ age ≤ 120)
- `Amount must be between 0.01 and 999999.99`

==== Exclusive Ranges

Use "greater than" / "less than" for exclusive:

- `Quantity must be greater than 0`
- `Discount must be less than 100%`

==== One-Sided Bounds

Use "at least" / "at most" for single bounds:

- `Password must be at least 8 characters`
- `Name must be at most 255 characters`

=== Contextual Phrasing

==== Operation Context

Tailor messages based on the operation:

[cols="1,2"]
|===
|Operation |Message Example

|CREATE
|"Email is required when creating a user"

|UPDATE
|"Tenant ID cannot be changed during update"

|DELETE
|"Cannot delete user: user not found"

|VALIDATE
|"Email format is invalid"
|===

==== Role-Based Context

Adjust guidance based on user role:

**Admin:**
[source]
----
"Cannot assign super-admin role. Contact system administrator."
----

**User:**
[source]
----
"You do not have permission to assign admin role. Contact your administrator."
----

**Viewer:**
[source]
----
"View-only access. Contact your administrator to request changes."
----

==== Multi-Tenant Context

Reference tenant-specific rules when applicable:

[source]
----
"Email domain not allowed for this organization. 
Allowed domains: company.com, company.net"
----

[source]
----
"This feature is not available in your current plan. 
Upgrade to Enterprise for access."
----

=== Suggestion Patterns

==== "Did You Mean?" Suggestions

Use when the value is close to a valid option:

[source]
----
Did you mean "admin"? Allowed roles: admin, user, viewer
----

**Pattern:**
[source]
----
Did you mean "{{suggestion}}"? Allowed values: {{allowed}}
----

**Rules:**

- Only suggest if Levenshtein distance ≤ 2
- Only suggest if confidence > 70%
- Show suggestion before full list
- Use quotes around suggestion

==== Expected Value Hints

Provide examples of valid formats:

[source]
----
Provide Email in the correct format. Expected: user@domain.com
----

[source]
----
UUID must be a valid UUID format. Example: 550e8400-e29b-41d4-a716-446655440000
----

==== Range and Pattern Hints

Clarify what constitutes a valid value:

[source]
----
Provide Age between 0 and 120. You provided: 150
----

[source]
----
Password must contain: at least 8 characters, 1 uppercase, 1 number
----

==== Dependency Hints

Explain relationships between fields:

[source]
----
Billing Address can only be set when Payment Method is provided
----

[source]
----
End Date must be after Start Date
----

==== Resolution Steps

Provide 2-3 concrete next steps:

[source]
----
1. Verify the email address format
2. Ensure it includes @ and a valid domain
3. Example: user@example.com
----

=== How-To-Fix Tips

==== Actionable Guidance

Focus on what to do, not what went wrong:

**❌ Descriptive Only:**
[source]
----
"The password you provided does not meet requirements"
----

**✅ Actionable:**
[source]
----
"Password must include: 8+ characters, 1 uppercase, 1 number, 1 symbol"
----

==== Alternative Actions

Suggest alternatives when the requested action isn't possible:

[source]
----
"Tenant ID cannot be changed. Create a new user if a different tenant is needed."
----

[source]
----
"Email already exists. Use the 'Forgot Password' link to access your account."
----

==== Contact Guidance

When admin intervention is needed:

[source]
----
"This operation requires administrator approval. 
Contact your administrator at admin@company.com"
----

[source]
----
"Feature not available in your plan. 
Contact sales@company.com or visit our pricing page."
----

=== Multi-Language Readiness

==== Template Design

Design messages to work well in translation:

**DO:**

- Use complete sentences
- Avoid abbreviations
- Keep sentence structure simple
- Use consistent terminology

**DON'T:**

- Use idioms or colloquialisms
- Concatenate sentence fragments
- Use gender-specific language
- Assume left-to-right reading

==== Parameter Ordering

Allow flexible parameter placement:

**❌ Rigid:**
[source]
----
"Must be between {{min}} and {{max}}" 
// Hard to translate to languages with different word order
----

**✅ Flexible:**
[source]
----
Template: "{{field-name}} must be between {{min}} and {{max}}"
Params: {field-name: "Age", min: "0", max: "120"}
// Translators can rearrange as needed
----

==== Cultural Considerations

Avoid culture-specific references:

**❌ Culture-Specific:**
[source]
----
"Please use MM/DD/YYYY format"  // US-centric
----

**✅ Universal:**
[source]
----
"Please use ISO 8601 date format (YYYY-MM-DD)"
----

=== Examples by Category

==== Schema Validation

[cols="1,2"]
|===
|Code |Message

|`:required`
|"{{field-name}} is required"

|`:invalid-format`
|"{{field-name}} format is invalid"

|`:invalid-value`
|"{{field-name}} must be one of: {{allowed}}"

|`:too-short`
|"{{field-name}} must be at least {{min}} characters"

|`:too-long`
|"{{field-name}} must be at most {{max}} characters"

|`:out-of-range`
|"{{field-name}} must be between {{min}} and {{max}}"
|===

==== Business Rules

[cols="1,2"]
|===
|Code |Message

|`:duplicate`
|"{{field-name}} already exists"

|`:forbidden`
|"Cannot modify {{field-name}}"

|`:not-found`
|"{{entity}} not found"

|`:dependency`
|"{{field-name}} requires {{dependency}}"

|`:conflict`
|"{{field-name}} conflicts with {{conflicting-field}}"
|===

==== Cross-Field Validation

[cols="1,2"]
|===
|Code |Message

|`:date-range`
|"{{end-field}} must be after {{start-field}}"

|`:mutual-exclusion`
|"Cannot set both {{field1}} and {{field2}}"

|`:conditional-required`
|"{{field-name}} is required when {{condition-field}} is {{value}}"
|===

=== Message Testing Checklist

When writing or reviewing error messages, verify:

☐ **Clarity:** Can a novice user understand the message?

☐ **Actionability:** Does it tell the user what to do?

☐ **Accuracy:** Is the technical information correct?

☐ **Consistency:** Does it follow established patterns?

☐ **Completeness:** Does it include all necessary information?

☐ **Conciseness:** Is it as brief as possible while remaining clear?

☐ **Tone:** Is it respectful and professional?

☐ **Examples:** Are provided examples valid and helpful?

☐ **Accessibility:** Can screen readers parse it correctly?

☐ **I18n-Ready:** Will it translate well to other languages?

== Validation Patterns

_(Additional sections to be expanded)_

=== Schema-First Validation

=== Business Rule Validation

=== Cross-Field Validation

=== Contextual Validation

=== Asynchronous Validation

== Testing Patterns

_(To be expanded in future iterations)_

=== Unit Testing Pure Validators

=== Property-Based Testing

=== Snapshot Testing

=== Integration Testing

---

*For implementation details, see link:error-codes.adoc[Error Code Catalog]*
