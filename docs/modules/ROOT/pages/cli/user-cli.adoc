= Boundary CLI - User and Session Management
:toc:
:toclevels: 3
:sectnums:

== Overview

The Boundary CLI provides command-line tools for managing users and sessions in the Boundary framework. It supports both table-based (default) and JSON output formats, making it suitable for both interactive use and scripting.

=== Key Features

* **Full CRUD Operations**: Create, read, update, and delete users
* **Session Management**: Create and invalidate user sessions
* **Flexible Output**: Table format for humans, JSON for automation

* **Input Validation**: Comprehensive validation with clear error messages
* **Exit Codes**: Standard exit codes (0=success, 1=error)

== Installation and Setup

=== Prerequisites

* Clojure 1.12.3 or higher
* Java 11 or higher
* Database configured (SQLite by default)

=== Running the CLI

From the project root:

[source,zsh]
----
# Using Clojure directly
clojure -M:cli user list 

# Using an alias (if configured)
boundary user list 
----

== Command Structure

=== General Syntax

[source]
----
boundary <domain> <command> [options]
----

Where:

* `<domain>`: Either `user` or `session`
* `<command>`: Operation to perform (create, list, find, etc.)
* `[options]`: Command-specific flags and arguments

=== Global Options

[cols="1,3"]
|===
|Option |Description

|`-f, --format FORMAT`
|Output format: `table` (default) or `json`

|`-h, --help`
|Show help text
|===

== User Management Commands

=== Create User

Create a new user account.

==== Syntax

[source,zsh]
----
boundary user create --email EMAIL --name NAME --role ROLE  [--active BOOL]
----

==== Required Options

[cols="1,3"]
|===
|Option |Description

|`--email EMAIL`
|User's email address (must be valid format)

|`--name NAME`
|User's full name

|`--role ROLE`
|User role: `admin`, `user`, or `viewer`

|``

|===

==== Optional Options

[cols="1,2,1"]
|===
|Option |Description |Default

|`--active BOOL`
|User active status (true/false/yes/no/1/0)
|`true`
|===

==== Examples

[source,zsh]
----
# Create active user with table output (default)
boundary user create \
  --email john.doe@example.com \
  --name "John Doe" \
  --role user \
  

# Create admin with JSON output
boundary user create \
  --email admin@example.com \
  --name "Admin User" \
  --role admin \
   \
  --format json

# Create inactive user
boundary user create \
  --email inactive@example.com \
  --name "Inactive User" \
  --role viewer \
   \
  --active false
----

==== Output

**Table format** (default):
----
+--------------------------------------+----------------------+-------------+------+--------+---------------------+
| ID                                   | Email                | Name        | Role | Active | Created             |
+--------------------------------------+----------------------+-------------+------+--------+---------------------+
| 123e4567-e89b-12d3-a456-426614174000 | john.doe@example.com | John Doe    | user | true   | 2024-10-30 20:42:00 |
+--------------------------------------+----------------------+-------------+------+--------+---------------------+
----

**JSON format**:
[source,json]
----
{
  "id": "123e4567-e89b-12d3-a456-426614174000",
  "email": "john.doe@example.com",
  "name": "John Doe",
  "role": "user",
  "active": true,
  "userId": "550e8400-e29b-41d4-a716-446655440000",
  "createdAt": "2024-10-30T20:42:00Z"
}
----

=== List Users

List all users with optional filtering.

==== Syntax

[source,zsh]
----
boundary user list  [--limit N] [--offset N] [--role ROLE] [--active BOOL]
----

==== Required Options

[cols="1,3"]
|===
|Option |Description

|``

|===

==== Optional Options

[cols="1,2,1"]
|===
|Option |Description |Default

|`--limit N`
|Maximum number of results
|20

|`--offset N`
|Number of results to skip
|0

|`--role ROLE`
|Filter by role (admin/user/viewer)
|All roles

|`--active BOOL`
|Filter by active status
|All statuses
|===

==== Examples

[source,zsh]
----
# List all users (default: first 20)
boundary user list 

# List only admins
boundary user list \
   \
  --role admin

# List inactive users with JSON output
boundary user list \
   \
  --active false \
  --format json

# Pagination: second page of 10 users
boundary user list \
   \
  --limit 10 \
  --offset 10
----

=== Find User

Find a specific user by ID or email.

==== Syntax

[source,zsh]
----
# Find by ID
boundary user find --id UUID

# Find by email
boundary user find --email EMAIL 
----

IMPORTANT: You must provide either `--id` OR `--email`.

==== Examples

[source,zsh]
----
# Find user by ID
boundary user find --id 123e4567-e89b-12d3-a456-426614174000

# Find user by email
boundary user find \
  --email john.doe@example.com \
  
----

=== Update User

Update user properties.

==== Syntax

[source,zsh]
----
boundary user update --id UUID [--name NAME] [--role ROLE] [--active BOOL]
----

==== Required Options

[cols="1,3"]
|===
|Option |Description

|`--id UUID`
|ID of user to update
|===

==== Optional Options

NOTE: At least one update field must be provided.

[cols="1,3"]
|===
|Option |Description

|`--name NAME`
|New user name

|`--role ROLE`
|New user role (admin/user/viewer)

|`--active BOOL`
|New active status
|===

==== Examples

[source,zsh]
----
# Update user name
boundary user update \
  --id 123e4567-e89b-12d3-a456-426614174000 \
  --name "John Smith"

# Promote user to admin
boundary user update \
  --id 123e4567-e89b-12d3-a456-426614174000 \
  --role admin

# Deactivate user
boundary user update \
  --id 123e4567-e89b-12d3-a456-426614174000 \
  --active false

# Multiple updates
boundary user update \
  --id 123e4567-e89b-12d3-a456-426614174000 \
  --name "John Administrator" \
  --role admin \
  --active true
----

=== Delete User

Soft-delete a user (marks as deleted but preserves data).

==== Syntax

[source,zsh]
----
boundary user delete --id UUID
----

==== Examples

[source,zsh]
----
boundary user delete --id 123e4567-e89b-12d3-a456-426614174000
----

WARNING: Soft-deleted users cannot be recovered through the CLI. Use database tools if recovery is needed.

== Session Management Commands

=== Create Session

Create a new user session (login).

==== Syntax

[source,zsh]
----
boundary session create --user-id UUID  [--user-agent STRING] [--ip-address IP]
----

==== Required Options

[cols="1,3"]
|===
|Option |Description

|`--user-id UUID`
|UUID of user creating session

|``

|===

==== Optional Options

[cols="1,3"]
|===
|Option |Description

|`--user-agent STRING`
|User agent string for session tracking

|`--ip-address IP`
|IP address for session tracking
|===

==== Examples

[source,zsh]
----
# Create basic session
boundary session create \
  --user-id 123e4567-e89b-12d3-a456-426614174000 \
  

# Create session with tracking info
boundary session create \
  --user-id 123e4567-e89b-12d3-a456-426614174000 \
   \
  --user-agent "Mozilla/5.0" \
  --ip-address "192.168.1.100"
----

=== Invalidate Session

Invalidate a session (logout).

==== Syntax

[source,zsh]
----
boundary session invalidate --token TOKEN
----

==== Examples

[source,zsh]
----
boundary session invalidate --token "session-token-abc123"
----

=== List Sessions

List all active sessions for a user.

==== Syntax

[source,zsh]
----
boundary session list --user-id UUID
----

==== Examples

[source,zsh]
----
boundary session list --user-id 123e4567-e89b-12d3-a456-426614174000
----

== Output Formats

=== Table Format (Default)

Table format is optimized for human readability:

* Column headers clearly labeled
* Data aligned for easy scanning
* Truncation for long values (with ellipsis)
* "No results found" message when empty

Example:
----
+--------------------------------------+----------------------+-------------+
| ID                                   | Email                | Name        |
+--------------------------------------+----------------------+-------------+
| 123e4567-e89b-12d3-a456-426614174000 | john.doe@example.com | John Doe    |
| 456e7890-e89b-12d3-a456-426614174001 | jane.doe@example.com | Jane Doe    |
+--------------------------------------+----------------------+-------------+
----

=== JSON Format

JSON format is optimized for programmatic use:

* Pretty-printed for readability
* Consistent structure across commands
* Lists include count and items
* Timestamps in ISO 8601 format
* UUIDs as strings

Example single entity:
[source,json]
----
{
  "id": "123e4567-e89b-12d3-a456-426614174000",
  "email": "john.doe@example.com",
  "name": "John Doe",
  "role": "user",
  "active": true,
  "userId": "550e8400-e29b-41d4-a716-446655440000",
  "createdAt": "2024-10-30T20:42:00Z"
}
----

Example list:
[source,json]
----
{
  "users": [
    { "id": "...", "email": "..." },
    { "id": "...", "email": "..." }
  ],
  "count": 2
}
----

== Error Handling

=== Exit Codes

[cols="1,3"]
|===
|Code |Meaning

|`0`
|Success

|`1`
|Error occurred (validation, not found, etc.)
|===

=== Error Messages

Errors are formatted according to the output format:

**Table format** (stderr):
----
Error: User not found
Details: No user found with ID: 123e4567-e89b-12d3-a456-426614174000
----

**JSON format** (stderr):
[source,json]
----
{
  "error": {
    "type": "user-not-found",
    "message": "User not found",
    "details": {
      "user-id": "123e4567-e89b-12d3-a456-426614174000"
    }
  }
}
----

=== Common Errors

[cols="1,2,2"]
|===
|Error Type |Cause |Solution

|`validation-error`
|Invalid input (bad email, role, UUID, etc.)
|Check input format and required fields

|`user-not-found`
|User ID or email not found
|Verify user exists

|`user-exists`
|Duplicate email
|Use different email or update existing user

|`parse-error`
|Invalid command-line arguments
|Check option syntax and values

|`unknown-command`
|Invalid domain or verb
|Use `--help` to see available commands
|===

== Best Practices

=== Scripting with JSON

When using the CLI in scripts, always use JSON format:

[source,zsh]
----
#!/bin/zsh

# Create user and capture ID
# User operations
RESULT=$(boundary user create \
  --email new@example.com \
  --name "New User" \
  --role user \
   \
  --format json)

USER_ID=$(echo "$RESULT" | jq -r '.id')
echo "Created user with ID: $USER_ID"
----

=== Boolean Values

The CLI accepts multiple formats for boolean values:

* Truthy: `true`, `yes`, `y`, `1`
* Falsy: `false`, `no`, `n`, `0`

All are case-insensitive.

=== UUID Format

UUIDs must be in canonical format (with hyphens):

* ✅ Good: `550e8400-e29b-41d4-a716-446655440000`
* ❌ Bad: `550e8400e29b41d4a716446655440000`

=== Considerations



* User email must be globally unique



== Troubleshooting

=== Database Connection Issues

[source]
----
Error: Failed to initialize database
----

*Solution*: Check database configuration in `resources/conf/dev/config.edn`

=== Invalid UUID Format

[source]
----
Error: Invalid arguments

----

*Solution*: Ensure UUIDs include hyphens and are properly formatted

=== Permission Denied

[source]
----
Error: User deletion not allowed
----

*Solution*: Check business rules - some users may be protected from deletion

=== Empty Results

When listing returns no results, verify:

1. Valid user exists
2. Proper permissions
3. Filters aren't too restrictive

== Architecture Notes

The CLI follows Boundary's Functional Core / Imperative Shell architecture:

* **Shell Layer**: CLI parsing, formatting, I/O
* **Service Layer**: Business logic coordination
* **Core Layer**: Pure business rules

This separation ensures:

* CLI can be tested without database
* Business logic is reusable across interfaces
* Clear separation of concerns

== See Also

* link:../architecture/overview.adoc[Boundary Architecture Overview]
* link:../boundary.prd.adoc[Product Requirements Document]
* link:../../warp.md[Boundary Developer Guide]


_Last updated: 2025-10-30_
