@startuml
!define RECTANGLE class

title Boundary Framework - Component Overview

package "Presentation Layer" {
  [REST API\n(Ring/Reitit)] as REST
  [CLI\n(tools.cli)] as CLI
  [Web Frontend\n(Replicant)] as WEB
}

package "Imperative Shell" {
  [HTTP Handlers] as HTTP_HANDLER
  [CLI Handlers] as CLI_HANDLER
  [Validation\n(Malli)] as VALIDATION
  [Error Translation] as ERROR_TRANS
  [Configuration\n(Aero)] as CONFIG
  [Logging\n(TeleMere)] as LOGGING
  
  package "Adapters" {
    [PostgreSQL\nAdapter] as PG_ADAPTER
    [Email\nAdapter] as EMAIL_ADAPTER
  }
  
  package "Ports" {
    interface "IUserRepository" as IUSER_REPO
    interface "IEmailService" as IEMAIL_SERVICE
  }
}

package "Functional Core" {
  [User Core\nFunctions] as USER_CORE
  [Job Core\nFunctions] as JOB_CORE
  [Business Rules\nEngine] as BIZ_RULES
}

' Presentation to Shell connections
REST --> HTTP_HANDLER
CLI --> CLI_HANDLER
WEB --> HTTP_HANDLER

' Shell internal connections
HTTP_HANDLER --> VALIDATION
CLI_HANDLER --> VALIDATION
VALIDATION --> USER_CORE
VALIDATION --> JOB_CORE

HTTP_HANDLER --> ERROR_TRANS
CLI_HANDLER --> ERROR_TRANS

' Adapter to Port connections
PG_ADAPTER ..|> IUSER_REPO
EMAIL_ADAPTER ..|> IEMAIL_SERVICE

' Core to Port connections  
USER_CORE --> IUSER_REPO
USER_CORE --> IEMAIL_SERVICE
JOB_CORE --> IUSER_REPO
BIZ_RULES --> IUSER_REPO

' Cross-cutting concerns
CONFIG ..> HTTP_HANDLER : configures
CONFIG ..> CLI_HANDLER : configures
CONFIG ..> PG_ADAPTER : configures

LOGGING ..> HTTP_HANDLER : logs
LOGGING ..> CLI_HANDLER : logs
LOGGING ..> ERROR_TRANS : logs

note right of USER_CORE : Pure functions only\nNo side effects\nDeterministic
note right of IUSER_REPO : Abstract interface\nCore depends only on this
note left of PG_ADAPTER : Concrete implementation\nShell wires this to port

@enduml
