@startuml
!define RECTANGLE class

title Ports and Adapters (Hexagonal Architecture)

skinparam hexagon {
  BackgroundColor LightGreen
  BorderColor DarkGreen
}

skinparam component {
  BackgroundColor<<port>> LightBlue
  BorderColor<<port>> DarkBlue
  BackgroundColor<<adapter>> LightYellow
  BorderColor<<adapter>> Orange
  BackgroundColor<<external>> LightGray
  BorderColor<<external>> Gray
}

' Central hexagon representing the Functional Core
hexagon "**FUNCTIONAL CORE**\n\nPure Business Logic\n• No Side Effects\n• Deterministic\n• Testable" as CORE

' Left side - User-Facing Adapters
package "User-Facing\nAdapters" {
  component "REST API\nAdapter" as REST_ADAPTER <<adapter>>
  component "CLI\nAdapter" as CLI_ADAPTER <<adapter>>
  component "Web UI\nAdapter" as WEB_ADAPTER <<adapter>>
  
  note bottom of REST_ADAPTER
    Translates HTTP requests
    to core function calls
  end note
}

' Left ports
component "Input Ports" as INPUT_PORTS <<port>> {
  portin "HTTP\nHandlers" as HTTP_PORT
  portin "CLI\nCommands" as CLI_PORT
  portin "Web\nActions" as WEB_PORT
}

' Right side - Infrastructure Adapters
package "Infrastructure\nAdapters" {
  component "PostgreSQL\nAdapter" as PG_ADAPTER <<adapter>>
  component "SMTP Email\nAdapter" as SMTP_ADAPTER <<adapter>>
  component "File System\nAdapter" as FS_ADAPTER <<adapter>>
  
  note bottom of PG_ADAPTER
    Implements repository
    protocols with SQL
  end note
}

' Right ports
component "Output Ports" as OUTPUT_PORTS <<port>> {
  portout "Repository\nProtocols" as REPO_PORT
  portout "Email\nService" as EMAIL_PORT
  portout "Config\nProvider" as CONFIG_PORT
}

' External systems
database "PostgreSQL\nDatabase" as POSTGRES <<external>>
cloud "SMTP\nServer" as SMTP <<external>>
storage "Configuration\nFiles" as FILES <<external>>

' Test adapters
package "Test Adapters" {
  component "In-Memory\nRepository" as MEM_ADAPTER <<adapter>>
  component "Console\nEmail" as CONSOLE_ADAPTER <<adapter>>
  
  note right of MEM_ADAPTER
    Used in tests
    Fast, isolated
  end note
}

' Connections - Driving side
REST_ADAPTER --> HTTP_PORT
CLI_ADAPTER --> CLI_PORT
WEB_ADAPTER --> WEB_PORT

INPUT_PORTS --> CORE

' Connections - Driven side
CORE --> OUTPUT_PORTS

REPO_PORT --> PG_ADAPTER
EMAIL_PORT --> SMTP_ADAPTER
CONFIG_PORT --> FS_ADAPTER

' External connections
PG_ADAPTER --> POSTGRES
SMTP_ADAPTER --> SMTP
FS_ADAPTER --> FILES

' Test adapter connections
REPO_PORT ..> MEM_ADAPTER : "test"
EMAIL_PORT ..> CONSOLE_ADAPTER : "test"

legend top left
  **Hexagonal Architecture Key Concepts**
  
  **Left Side - User-Facing Adapters**
  • REST API, CLI, Web UI
  • Initiate user workflows
  • Bidirectional: Request IN, Response OUT
  
  **Right Side - Infrastructure Adapters**
  • Database, Email, File System
  • Support core business logic
  • Bidirectional: Query IN (read), Command OUT (write)
  
  **Important: ALL adapters are bidirectional**
  Data flows BOTH ways through every port
  
  **Ports** (Protocols/Interfaces)
  • Abstract boundaries
  • Bidirectional communication contracts
  • Technology-agnostic
  
  **Adapters** (Implementations)
  • All adapters are equal
  • Handle technology specifics
  • Both input and output operations
  
  **Core Benefits:**
  ✅ Business logic isolated from infrastructure
  ✅ Easy to test with mock adapters
  ✅ All external communication through ports
  ✅ Direction of data flow ≠ Direction of dependency
endlegend

@enduml
